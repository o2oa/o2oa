MWF.xDesktop.requireApp("portal.PortalManager","package",null,false);MWF.xDesktop.requireApp("Organization","Selector.package",null,false);MWF.require("MWF.xAction.org.express.RestActions",null,false);MWF.require("MWF.widget.Identity",null,false);MWF.xDesktop.requireApp("process.ProcessManager","",null,false);MWF.xApplication.portal=MWF.xApplication.portal||{};MWF.xApplication.portal.PortalManager.Main=new Class({Extends:MWF.xApplication.process.ProcessManager.Main,Implements:[Options,Events],options:{application:null,style:"default",name:"portal.PortalManager",icon:"icon.png",width:"1100",height:"700",title:MWF.xApplication.portal.PortalManager.LP.title},onQueryLoad:function(){this.lp=MWF.xApplication.portal.PortalManager.LP;this.currentContentNode=null;this.restActions=MWF.Actions.get("x_portal_assemble_designer")},loadStartMenu:function(t){this.startMenuNode=new Element("div",{styles:this.css.startMenuNode}).inject(this.node);this.menu=new MWF.xApplication.portal.PortalManager.Menu(this,this.startMenuNode,{onPostLoad:function(){if(this.status){if(this.status.navi!=null){this.menu.doAction(this.menu.startNavis[this.status.navi])}else{this.menu.doAction(this.menu.startNavis[0])}}else{this.menu.doAction(this.menu.startNavis[0])}}.bind(this)});this.addEvent("resize",function(){if(this.menu)this.menu.onResize()}.bind(this))},clearContent:function(){if(this.pageConfiguratorContent){if(this.pageConfigurator)delete this.pageConfigurator;this.pageConfiguratorContent.destroy();this.pageConfiguratorContent=null}if(this.menuConfiguratorContent){if(this.menuConfigurator)delete this.menuConfigurator;this.menuConfiguratorContent.destroy();this.menuConfiguratorContent=null}if(this.propertyConfiguratorContent){if(this.property)delete this.property;this.propertyConfiguratorContent.destroy();this.propertyConfiguratorContent=null}if(this.widgetConfiguratorContent){if(this.widgetConfigurator)delete this.widgetConfigurator;this.widgetConfiguratorContent.destroy();this.widgetConfiguratorContent=null}if(this.scriptConfiguratorContent){if(this.scriptConfigurator)delete this.scriptConfigurator;this.scriptConfiguratorContent.destroy();this.scriptConfiguratorContent=null}if(this.fileConfiguratorContent){if(this.fileConfigurator)delete this.fileConfigurator;this.fileConfiguratorContent.destroy();this.fileConfiguratorContent=null}},applicationProperty:function(){this.clearContent();this.propertyConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node);this.property=new MWF.xApplication.portal.PortalManager.ApplicationProperty(this,this.propertyConfiguratorContent);this.property.load()},pageConfig:function(){this.clearContent();this.pageConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node);this.loadPageConfig()},loadPageConfig:function(){MWF.xDesktop.requireApp("portal.PortalManager","PageExplorer",function(){this.pageConfigurator=new MWF.xApplication.portal.PortalManager.PageExplorer(this.pageConfiguratorContent,this.restActions);this.pageConfigurator.app=this;this.pageConfigurator.load()}.bind(this))},menuConfig:function(){this.clearContent();this.menuConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node);this.loadMenuConfig()},loadMenuConfig:function(){MWF.xDesktop.requireApp("portal.PortalManager","MenuExplorer",function(){if(!this.restActions)this.restActions=MWF.Actions.get("x_portal_assemble_designer");this.menuConfigurator=new MWF.xApplication.portal.PortalManager.MenuExplorer(this.menuConfiguratorContent,this.restActions);this.menuConfigurator.app=this;this.menuConfigurator.load()}.bind(this))},widgetConfig:function(){debugger;this.clearContent();this.widgetConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node);this.loadWidgetConfig()},loadWidgetConfig:function(){MWF.xDesktop.requireApp("portal.PortalManager","WidgetExplorer",function(){this.widgetConfigurator=new MWF.xApplication.portal.PortalManager.WidgetExplorer(this.widgetConfiguratorContent,this.restActions);this.widgetConfigurator.app=this;this.widgetConfigurator.load()}.bind(this))},scriptConfig:function(){this.clearContent();this.scriptConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node);this.loadScriptConfig()},loadScriptConfig:function(){MWF.xDesktop.requireApp("portal.PortalManager","ScriptExplorer",function(){if(!this.restActions)this.restActions=MWF.Actions.get("x_portal_assemble_designer");this.scriptConfigurator=new MWF.xApplication.portal.PortalManager.ScriptExplorer(this.scriptConfiguratorContent,this.restActions);this.scriptConfigurator.app=this;this.scriptConfigurator.load()}.bind(this))},fileConfig:function(){debugger;this.clearContent();this.fileConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node);this.loadFileConfig()},loadFileConfig:function(){MWF.xDesktop.requireApp("portal.PortalManager","FileExplorer",function(){this.restActions=MWF.Actions.get("x_portal_assemble_designer");this.fileConfigurator=new MWF.xApplication.portal.PortalManager.FileExplorer(this.fileConfiguratorContent,this.restActions);this.fileConfigurator.app=this;this.fileConfigurator.load()}.bind(this))}});MWF.xApplication.portal.PortalManager.Menu=new Class({Extends:MWF.xApplication.process.ProcessManager.Menu,Implements:[Options,Events]});MWF.xApplication.portal.PortalManager.ApplicationProperty=new Class({Extends:MWF.xApplication.process.ProcessManager.ApplicationProperty,createPropertyContentNode:function(){this.propertyContentNode=new Element("div",{styles:{overflow:"hidden","-webkit-user-select":"text","-moz-user-select":"text"}}).inject(this.contentAreaNode);var t="<table cellspacing='0' cellpadding='0' border='0' width='95%' align='center' style='margin-top: 20px'>";t+="<tr><td class='formTitle'>"+this.app.lp.application.name+"</td><td id='formApplicationName'></td></tr>";t+="<tr><td class='formTitle'>"+this.app.lp.application.alias+"</td><td id='formApplicationAlias'></td></tr>";t+="<tr><td class='formTitle'>"+this.app.lp.application.description+"</td><td id='formApplicationDescription'></td></tr>";t+="<tr><td class='formTitle'>"+this.app.lp.application.type+"</td><td id='formApplicationType'></td></tr>";t+="<tr><td class='formTitle'>"+this.app.lp.application.firstPage+"</td><td id='formApplicationFirstPage'></td></tr>";t+="<tr><td class='formTitle'>"+this.app.lp.application.id+"</td><td id='formApplicationId'></td></tr>";t+="<tr><td class='formTitle'>"+this.app.lp.application.url+"</td><td id='formApplicationUrl'></td></tr>";t+="</table>";this.propertyContentNode.set("html",t);this.propertyContentNode.getElements("td.formTitle").setStyles(this.app.css.propertyBaseContentTdTitle);this.nameInput=new MWF.xApplication.portal.PortalManager.Input(this.propertyContentNode.getElement("#formApplicationName"),this.data.name,this.app.css.formInput);this.aliasInput=new MWF.xApplication.portal.PortalManager.Input(this.propertyContentNode.getElement("#formApplicationAlias"),this.data.alias,this.app.css.formInput);this.descriptionInput=new MWF.xApplication.portal.PortalManager.Input(this.propertyContentNode.getElement("#formApplicationDescription"),this.data.description,this.app.css.formInput);this.typeInput=new MWF.xApplication.portal.PortalManager.Input(this.propertyContentNode.getElement("#formApplicationType"),this.data.applicationCategory,this.app.css.formInput);this.firstPageInput=new MWF.xApplication.portal.PortalManager.Select(this.propertyContentNode.getElement("#formApplicationFirstPage"),this.data.firstPage,this.app.css.formInput,function(){var i={};debugger;this.app.restActions.listPage(this.app.options.application.id,function(t){t.data.each(function(t){i[t.id]=t.name}.bind(this))}.bind(this),null,false);return i}.bind(this));this.idInput=new MWF.xApplication.portal.PortalManager.Input(this.propertyContentNode.getElement("#formApplicationId"),this.data.id,this.app.css.formInput);var i=window.location.host;var e="?id="+this.data.id;var n="http://"+i+"/x_desktop/portal.html"+e;this.urlInput=new MWF.xApplication.portal.PortalManager.Input(this.propertyContentNode.getElement("#formApplicationUrl"),n,this.app.css.formInput)},editMode:function(){this.nameInput.editMode();this.aliasInput.editMode();this.descriptionInput.editMode();this.typeInput.editMode();this.firstPageInput.editMode();this.isEdit=true},readMode:function(){this.nameInput.readMode();this.aliasInput.readMode();this.descriptionInput.readMode();this.typeInput.readMode();this.firstPageInput.readMode();this.isEdit=false},save:function(i,n){this.data.name=this.nameInput.input.get("value");this.data.alias=this.aliasInput.input.get("value");this.data.description=this.descriptionInput.input.get("value");this.data.applicationCategory=this.typeInput.input.get("value");this.data.firstPage=this.firstPageInput.input.get("value");this.app.restActions.saveApplication(this.data,function(t){this.propertyTitleBar.set("text",this.data.name);this.data.id=t.data.id;this.nameInput.save();this.aliasInput.save();this.descriptionInput.save();this.typeInput.save();this.firstPageInput.save();if(i)i()}.bind(this),function(t,i,e){if(n)n(t,i,e)}.bind(this))}});MWF.xApplication.portal.PortalManager.Input=new Class({Extends:MWF.xApplication.process.ProcessManager.Input,Implements:[Events]});MWF.xApplication.portal.PortalManager.Select=new Class({Extends:MWF.xApplication.portal.PortalManager.Input,Implements:[Events],initialize:function(t,i,e,n){this.node=$(t);this.value=i?i:"";this.style=e;this.select=n;this.selectList=null;this.load()},getSelectList:function(){if(this.select){return this.select()}return[]},getText:function(t){if(t){if(this.selectList){return this.selectList[t]||""}}return""},load:function(){this.selectList=this.getSelectList();this.content=new Element("div",{styles:this.style.content,text:this.getText(this.value)}).inject(this.node)},editMode:function(){this.content.empty();this.input=new Element("select",{}).inject(this.content);Object.each(this.selectList,function(t,i){new Element("option",{value:i,text:t,selected:this.value==t}).inject(this.input)}.bind(this))},readMode:function(){this.content.empty();this.input=null;this.content.set("text",this.getText(this.value))},save:function(){if(this.input)this.value=this.input.options[this.input.selectedIndex].get("value");return this.value}});