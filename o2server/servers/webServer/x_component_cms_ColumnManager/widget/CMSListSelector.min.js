MWF.xApplication.Selector=MWF.xApplication.Selector||{};MWF.xDesktop.requireApp("Selector","Person",null,false);MWF.xApplication.Selector.ListSelector=new Class({Extends:MWF.xApplication.Selector.Person,options:{style:"default",count:0,title:"选择列表",values:[],appId:"",formId:"",expand:false},initialize:function(t,e){this.setOptions(e);this.path="/x_component_Selector/$Selector/";this.cssPath="/x_component_Selector/$Selector/"+this.options.style+"/css.wcss";this._loadCss(true);this.container=$(t);this.action=MWF.Actions.get("x_cms_assemble_control");this.lastPeople="";this.pageCount="13";this.selectedItems=[];this.items=[]},loadSelectItems:function(t){this.action.listView(this.options.appId,function(t){t.data=t.data||[];if(t.data.length){var e={};t.data.each(function(t){if(!e[t.formId]){e[t.formId]={id:t.formId,name:t.formName,viewList:[t]}}else{e[t.formId].viewList.push(t)}}.bind(this));var i=this._newItem({name:"系统列表",id:"defaultList"},this,this.itemAreaNode);this.items.push(i);for(var n in e){var s=this._newItemCategory(e[n],this,this.itemAreaNode);e[n].viewList.each(function(t){var e=this._newItem(t,this,s.children);this.items.push(e)}.bind(this))}}else{var i=this._newItem({name:"系统列表",id:"defaultList"},this,this.itemAreaNode);this.items.push(i)}}.bind(this))},_scrollEvent:function(t){return true},_getChildrenItemIds:function(t){return t.viewList||[]},_newItemCategory:function(t,e,i,n){return new MWF.xApplication.Selector.ListSelector.ItemCategory(t,e,i,n)},_listItemByKey:function(t,e,i){return false},_getItem:function(e,t,i,n){this.action.getProcess(function(t){if(e)e.apply(this,[t])}.bind(this),t,typeOf(i)==="string"?i:i.id,n)},_newItemSelected:function(t,e,i){return new MWF.xApplication.Selector.ListSelector.ItemSelected(t,e,i)},_listItemByPinyin:function(t,e,i){return false},_newItem:function(t,e,i,n){return new MWF.xApplication.Selector.ListSelector.Item(t,e,i,n)}});MWF.xApplication.Selector.ListSelector.Item=new Class({Extends:MWF.xApplication.Selector.Person.Item,_getShowName:function(){return this.data.name},_setIcon:function(){},loadSubItem:function(){return false},checkSelectedSingle:function(){var t=this.selector.options.values.filter(function(t,e){if(typeOf(t)==="object")return this.data.id===t.id||this.data.name===t.name;if(typeOf(t)==="string")return this.data.id===t||this.data.name===t;return false}.bind(this));if(t.length){this.selectedSingle()}},checkSelected:function(){var t=this.selector.selectedItems.filter(function(t,e){return t.data.id===this.data.id||t.data.name===this.data.name}.bind(this));if(t.length){t[0].addItem(this);this.selectedItem=t[0];this.setSelected()}}});MWF.xApplication.Selector.ListSelector.ItemSelected=new Class({Extends:MWF.xApplication.Selector.Person.ItemSelected,_getShowName:function(){return this.data.name},_setIcon:function(){},check:function(){if(this.selector.items.length){var t=this.selector.items.filter(function(t,e){return t.data.id===this.data.id||t.data.name===this.data.name}.bind(this));this.items=t;if(t.length){t.each(function(t){t.selectedItem=this;t.setSelected()}.bind(this))}}}});MWF.xApplication.Selector.ListSelector.ItemCategory=new Class({Extends:MWF.xApplication.Selector.Person.ItemCategory,_getShowName:function(){return this.data.name},createNode:function(){this.node=new Element("div",{styles:this.selector.css.selectorItemCategory_department}).inject(this.container)},_setIcon:function(){this.iconNode.setStyle("background-image","url("+"/x_component_Selector/$Selector/default/icon/applicationicon.png)")},_hasChild:function(){return this.data.viewList&&this.data.viewList.length},check:function(){}});