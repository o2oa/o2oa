MWF.xApplication.Execution=MWF.xApplication.Execution||{};MWF.xDesktop.requireApp("Template","Explorer",null,false);MWF.xDesktop.requireApp("Execution","WorkMinder",null,false);MWF.require("MWF.widget.Identity",null,false);MWF.xApplication.Execution.MinderExplorer=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default"},initialize:function(t,e,i,s){this.app=e;this.lp=e.lp;this.path="/x_component_Execution/$MinderExplorer/";this.actions=i;this.options.style=this.getViewStyle();this.setOptions(s);this.loadCss();this.node=$(t)},loadCss:function(){this.cssPath="/x_component_Execution/$MinderExplorer/"+this.options.style+"/css.wcss";this._loadCss()},load:function(){this.middleContent=this.app.middleContent;this.createNaviContent();this.resizeWindow();this.app.addEvent("resize",function(){this.resizeWindow()}.bind(this))},resizeWindow:function(){var t=this.app.middleContent.getSize();this.naviDiv.setStyles({height:t.y-40+"px"});this.naviContentDiv.setStyles({height:t.y-180+"px"});this.contentDiv.setStyles({height:t.y-40+"px"})},createNaviContent:function(){this.naviDiv=new Element("div.naviDiv",{styles:this.css.naviDiv}).inject(this.middleContent);this.naviTitleDiv=new Element("div.naviTitleDiv",{styles:this.css.naviTitleDiv,text:this.lp.minderExplorerTitle}).inject(this.naviDiv);this.naviContentDiv=new Element("div.naviContentDiv",{styles:this.css.naviContentDiv}).inject(this.naviDiv);this.naviBottomDiv=new Element("div.naviBottomDiv",{styles:this.css.naviBottomDiv}).inject(this.naviDiv);this.createContentDiv();var t=this.path+"navi.json";MWF.getJSON(t,function(t){t.each(function(t,e){var i=new Element("li.naviContentLi",{styles:this.css.naviContentLi}).inject(this.naviContentDiv);i.addEvents({mouseover:function(t){if(this.bindObj.currentNaviItem!=this.node)this.node.setStyles(this.styles)}.bind({styles:this.css.naviContentLi_over,node:i,bindObj:this}),mouseout:function(t){if(this.bindObj.currentNaviItem!=this.node)this.node.setStyles(this.styles)}.bind({styles:this.css.naviContentLi,node:i,bindObj:this}),click:function(t){if(this.bindObj.currentNaviItem)this.bindObj.currentNaviItem.setStyles(this.bindObj.css.naviContentLi);this.node.setStyles(this.styles);this.bindObj.currentNaviItem=this.node;if(this.action&&this.bindObj[this.action]){this.bindObj[this.action]()}}.bind({styles:this.css.naviContentLi_current,node:i,bindObj:this,action:t.action})});var s=new Element("img.naviContentImg",{styles:this.css.naviContentImg,src:"/x_component_Execution/$Main/default/icon/"+t.icon}).inject(i);var n=new Element("span.naviContentSpan",{styles:this.css.naviContentSpan,text:t.title}).inject(i);if(e==0){i.click()}}.bind(this))}.bind(this))},createContentDiv:function(){this.contentDiv=new Element("div.contentDiv",{styles:this.css.contentDiv}).inject(this.middleContent)},openCenterWork:function(){this.contentDiv.empty();this.loadCategoryBar();this.loadToolbar()},loadCategoryBar:function(){var t=this;this.categoryBar=new Element("div.categoryBar",{styles:this.css.categoryBar}).inject(this.contentDiv);this.allCategoryNode=new Element("li.allCategoryNode",{styles:this.css.categoryNode,text:"全部"}).inject(this.categoryBar);this.allCategoryNode.addEvents({mouseover:function(){if(this.currentCategoryNode!=this.allCategoryNode)this.allCategoryNode.setStyles(this.css.categoryNode_over)}.bind(this),mouseout:function(){if(this.currentCategoryNode!=this.allCategoryNode)this.allCategoryNode.setStyles(this.css.categoryNode)}.bind(this),click:function(){if(this.currentCategoryNode)this.currentCategoryNode.setStyles(this.css.categoryNode);this.currentCategoryNode=this.allCategoryNode;this.allCategoryNode.setStyles(this.css.categoryNode_current);this.loadView()}.bind(this)});this.actions.getCategoryCountAll(function(e){e.data=e.data||[];e.data.each(function(e){var i=new Element("li.categoryNode",{styles:this.css.categoryNode,text:e.workTypeName+"("+e.centerCount+")"}).inject(this.categoryBar);i.store("workTypeName",e.workTypeName);i.addEvents({mouseover:function(){if(t.currentCategoryNode!=this.node)this.node.setStyles(t.css.categoryNode_over)}.bind({node:i}),mouseout:function(){if(t.currentCategoryNode!=this.node)this.node.setStyles(t.css.categoryNode)}.bind({node:i}),click:function(){if(t.currentCategoryNode)t.currentCategoryNode.setStyles(t.css.categoryNode);t.currentCategoryNode=this.node;this.node.setStyles(t.css.categoryNode_current);t.loadView()}.bind({name:e.workTypeName,node:i})})}.bind(this))}.bind(this),null,false);this.allCategoryNode.click()},loadToolbar:function(){this.toolbar=new Element("div",{styles:this.css.toolbar}).inject(this.categoryBar);this.fileterNode=new Element("div",{styles:this.css.fileterNode}).inject(this.toolbar);this.loadFilter()},loadFilter:function(){var t=this;var e="<table bordr='0' cellpadding='5' cellspacing='0' styles='filterTable'>"+"<tr>"+"    <td styles='filterTableValue' item='title'></td>"+"    <td styles='filterTableValue' item='searchAction'></td>"+"    <td styles='filterTableValue' item='returnAction' style='display:none;'></td>"+"</tr>"+"</table>";this.fileterNode.set("html",e);MWF.xDesktop.requireApp("Template","MForm",function(){this.filter=new MForm(this.fileterNode,{},{style:"execution",isEdited:true,itemTemplate:{year:{text:this.lp.yearCount+":",type:"select",className:"inputSelectUnformatWidth",selectValue:function(){var t=[],e=(new Date).getFullYear();for(var i=0;i<6;i++)t.push(e--);return t}},workLevel:{text:this.lp.level+":",type:"select",className:"inputSelectUnformatWidth",selectValue:this.lp.workForm.workLevelValue.split(",")},workType:{text:this.lp.type+":",type:"select",className:"inputSelectUnformatWidth",selectValue:this.lp.workForm.workTypeValue.split(",")},star:{text:this.lp.starWork+":",type:"select",className:"inputSelectUnformatWidth",selectValue:this.lp.starWorkText.split(",")},title:{style:this.css.filterTitle,defaultValue:this.lp.searchText,event:{focus:function(e){if(e.get("value")==t.lp.searchText)e.setValue("")},blur:function(e){if(e.get("value").trim()=="")e.setValue(t.lp.searchText)},keydown:function(e,i){if(i.code==13){t.fileterNode.getElements("[item='returnAction']").setStyle("display","");t.loadView()}}.bind(this)}},searchAction:{type:"button",value:this.lp.search,style:this.css.filterButton,event:{click:function(){t.fileterNode.getElements("[item='returnAction']").setStyle("display","");t.loadView()}}},returnAction:{type:"button",value:this.lp.return,style:this.css.filterButton,event:{click:function(){t.filter.getItem("title").setValue(t.lp.searchText);t.fileterNode.getElements("[item='returnAction']").setStyle("display","none");t.loadView()}}}}},this.app,this.css);this.filter.load()}.bind(this),true)},loadView:function(){var t={};if(this.currentCategoryNode){var e=this.currentCategoryNode.retrieve("workTypeName");if(e&&e!=""){t.workTypes=[e]}}if(this.filter){var i=this.filter.getResult(true,",",true,true,true);i.title=i.title.replace(this.lp.searchText,"");for(var s in i){if(i[s]!=""){t[s]=i[s]}}}var n=false;if(this.viewContainer){n=true;this.viewContainer.destroy()}this.viewContainer=Element("div",{styles:this.css.viewContainer}).inject(this.contentDiv);this.setViewSize();if(!n){this.setViewSizeFun=this.setViewSize.bind(this);this.app.addEvent("resize",this.setViewSizeFun)}if(this.view){this.view.destroy()}this.getViewStyle();this.view=new MWF.xApplication.Execution.MinderExplorer.WorkView(this.viewContainer,this.app,this,{templateUrl:this.path+(this.getViewStyle()=="default"?"listItem.json":"listItem_graph.json"),scrollEnable:true},{lp:this.lp.centerWorkView});if(t)this.view.filterData=t;this.view.load()},getViewStyle:function(){if(this.viewStyle)return this.viewStyle;this.actions.getProfileByCode({configCode:"MIND_LISTSTYLE"},function(t){if(t.data){this.viewStyle=t.data.configValue=="ICON"?"graph":"default"}else{this.viewStyle="default"}}.bind(this),function(){this.viewStyle="default"}.bind(this),false);return this.viewStyle||"default"},setViewSize:function(){var t=this.app.middleContent.getSize();var e=this.categoryBar?this.categoryBar.getSize():{x:0,y:0};this.viewContainer.setStyles({height:t.y-e.y-56+"px"})}});MWF.xApplication.Execution.MinderExplorer.WorkView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t){return new MWF.xApplication.Execution.MinderExplorer.WorkDocument(this.viewNode,t,this.explorer,this)},_getCurrentPageData:function(t,e){if(!e)e=20;var i=this.items.length?this.items[this.items.length-1].data.id:"(0)";var s=this.filterData||{};this.actions.getCenterWorkListNext(i,e,s,function(e){if(t)t(e)}.bind(this))},_removeDocument:function(t,e){},_create:function(){},_openDocument:function(t){var e=new MWF.xApplication.Execution.WorkMinder(this.explorer,t,{});e.load()},_queryCreateViewNode:function(){},_postCreateViewNode:function(t){},_queryCreateViewHead:function(){},_postCreateViewHead:function(t){}});MWF.xApplication.Execution.MinderExplorer.WorkDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,mouseoverDocument:function(){this.node.getElements("[styles='documentItemTitleNode']").setStyles(this.css["documentItemTitleNode_over"]);this.node.getElements("[styles='documentItemIconNode']").setStyles(this.css["documentItemIconNode_over"]);this.node.getElements("[styles='documentItemStatNode']").setStyles(this.css["documentItemStatNode_over"])},mouseoutDocument:function(){this.node.getElements("[styles='documentItemTitleNode']").setStyles(this.css["documentItemTitleNode"]);this.node.getElements("[styles='documentItemIconNode']").setStyles(this.css["documentItemIconNode"]);this.node.getElements("[styles='documentItemStatNode']").setStyles(this.css["documentItemStatNode"])},_queryCreateDocumentNode:function(t){},_postCreateDocumentNode:function(t,e){},removeCenterWork:function(t){return false}});