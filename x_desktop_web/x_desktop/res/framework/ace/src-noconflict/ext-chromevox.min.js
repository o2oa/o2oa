ace.define("ace/ext/chromevox",["require","exports","module","ace/editor","ace/config"],function(e,r,n){var o={};o.SpeechProperty;o.Cursor;o.Token;o.Annotation;var t={rate:.8,pitch:.4,volume:.9};var a={rate:1,pitch:.5,volume:.9};var i={rate:.8,pitch:.8,volume:.9};var c={rate:.8,pitch:.3,volume:.9};var u={rate:.8,pitch:.7,volume:.9};var v={rate:.8,pitch:.8,volume:.9};var s={punctuationEcho:"none",relativePitch:-.6};var f="ALERT_NONMODAL";var l="ALERT_MODAL";var p="INVALID_KEYPRESS";var d="insertMode";var m="start";var g=[{substr:";",newSubstr:" semicolon "},{substr:":",newSubstr:" colon "}];var A={SPEAK_ANNOT:"annots",SPEAK_ALL_ANNOTS:"all_annots",TOGGLE_LOCATION:"toggle_location",SPEAK_MODE:"mode",SPEAK_ROW_COL:"row_col",TOGGLE_DISPLACEMENT:"toggle_displacement",FOCUS_TEXT:"focus_text"};var k="CONTROL + SHIFT ";o.editor=null;var h=null;var S={};var E=false;var x=false;var y=false;var w=null;var b={};var T={};var C=function(e){return k+String.fromCharCode(e)};var O=function(){var e=o.editor.keyBinding.getKeyboardHandler();return e.$id==="ace/keyboard/vim"};var _=function(e){return o.editor.getSession().getTokenAt(e.row,e.column+1)};var L=function(e){return o.editor.getSession().getLine(e.row)};var N=function(e){if(S[e.row]){cvox.Api.playEarcon(f)}if(E){cvox.Api.stop();X(e);$(_(e));B(e.row,1)}else{B(e.row,0)}};var K=function(e){var r=L(e);var n=r.substr(e.column-1);if(e.column===0){n=" "+r}var o=/^\W(\w+)/;var t=o.exec(n);return t!==null};var P={constant:{prop:t},entity:{prop:i},keyword:{prop:c},storage:{prop:u},variable:{prop:v},meta:{prop:a,replace:[{substr:"</",newSubstr:" closing tag "},{substr:"/>",newSubstr:" close tag "},{substr:"<",newSubstr:" tag start "},{substr:">",newSubstr:" tag end "}]}};var I={prop:I};var M=function(e,r){var n=e;for(var o=0;o<r.length;o++){var t=r[o];var a=new RegExp(t.substr,"g");n=n.replace(a,t.newSubstr)}return n};var D=function(e,r,n){var o={};o.value="";o.type=e[r].type;for(var t=r;t<n;t++){o.value+=e[t].value}return o};var G=function(e){if(e.length<=1){return e}var r=[];var n=0;for(var o=1;o<e.length;o++){var t=e[n];var a=e[o];if(q(t)!==q(a)){r.push(D(e,n,o));n=o}}r.push(D(e,n,e.length));return r};var R=function(e){var r=o.editor.getSession().getLine(e);var n=/^\s*$/;return n.exec(r)!==null};var B=function(e,r){var n=o.editor.getSession().getTokens(e);if(n.length===0||R(e)){cvox.Api.playEarcon("EDITABLE_TEXT");return}n=G(n);var t=n[0];n=n.filter(function(e){return e!==t});W(t,r);n.forEach($)};var F=function(e){W(e,0)};var $=function(e){W(e,1)};var q=function(e){if(!e||!e.type){return}var r=e.type.split(".");if(r.length===0){return}var n=r[0];var o=P[n];if(!o){return I}return o};var W=function(e,r){var n=q(e);var o=M(e.value,g);if(n.replace){o=M(o,n.replace)}cvox.Api.speak(o,r,n.prop)};var X=function(e){var r=L(e);cvox.Api.speak(r[e.column],1)};var H=function(e,r){var n=L(r);var o=n.substring(e.column,r.column);o=o.replace(/ /g," space ");cvox.Api.speak(o)};var U=function(e,r){if(Math.abs(e.column-r.column)!==1){var n=L(r).length;if(r.column===0||r.column===n){B(r.row,0);return}if(K(r)){cvox.Api.stop();$(_(r));return}}X(r)};var V=function(e,r){if(!o.editor.selection.isEmpty()){H(e,r);cvox.Api.speak("selected",1)}else if(x){H(e,r)}else{U(e,r)}};var J=function(e){if(y){y=false;return}var r=o.editor.selection.getCursor();if(r.row!==h.row){N(r)}else{V(h,r)}h=r};var Y=function(e){if(o.editor.selection.isEmpty()){cvox.Api.speak("unselected")}};var j=function(e){switch(data.action){case"remove":cvox.Api.speak(data.text,0,s);y=true;break;case"insert":cvox.Api.speak(data.text,0);y=true;break}};var z=function(e){var r=e.row;var n=e.column;return!S[r]||!S[r][n]};var Q=function(e){S={};for(var r=0;r<e.length;r++){var n=e[r];var o=n.row;var t=n.column;if(!S[o]){S[o]={}}S[o][t]=n}};var Z=function(e){var r=o.editor.getSession().getAnnotations();var n=r.filter(z);if(n.length>0){cvox.Api.playEarcon(f)}Q(r)};var ee=function(e){var r=e.type+" "+e.text+" on "+ne(e.row,e.column);r=r.replace(";","semicolon");cvox.Api.speak(r,1)};var re=function(e){var r=S[e];for(var n in r){ee(r[n])}};var ne=function(e,r){return"row "+(e+1)+" column "+(r+1)};var oe=function(){cvox.Api.speak(ne(h.row,h.column))};var te=function(){for(var e in S){re(e)}};var ae=function(){if(!O()){return}switch(o.editor.keyBinding.$data.state){case d:cvox.Api.speak("Insert mode");break;case m:cvox.Api.speak("Command mode");break}};var ie=function(){E=!E;if(E){cvox.Api.speak("Speak location on row change enabled.")}else{cvox.Api.speak("Speak location on row change disabled.")}};var ce=function(){x=!x;if(x){cvox.Api.speak("Speak displacement on column changes.")}else{cvox.Api.speak("Speak current character or word on column changes.")}};var ue=function(e){if(e.ctrlKey&&e.shiftKey){var r=b[e.keyCode];if(r){r.func()}}};var ve=function(e,r){if(!O()){return}var n=r.keyBinding.$data.state;if(n===w){return}switch(n){case d:cvox.Api.playEarcon(l);cvox.Api.setKeyEcho(true);break;case m:cvox.Api.playEarcon(l);cvox.Api.setKeyEcho(false);break}w=n};var se=function(e){var r=e.detail["customCommand"];var n=T[r];if(n){n.func();o.editor.focus()}};var fe=function(){var e=de.map(function(e){return{desc:e.desc+C(e.keyCode),cmd:e.cmd}});var r=document.querySelector("body");r.setAttribute("contextMenuActions",JSON.stringify(e));r.addEventListener("ATCustomEvent",se,true)};var le=function(e){if(e.match){B(h.row,0)}else{cvox.Api.playEarcon(p)}};var pe=function(){o.editor.focus()};var de=[{keyCode:49,func:function(){re(h.row)},cmd:A.SPEAK_ANNOT,desc:"Speak annotations on line"},{keyCode:50,func:te,cmd:A.SPEAK_ALL_ANNOTS,desc:"Speak all annotations"},{keyCode:51,func:ae,cmd:A.SPEAK_MODE,desc:"Speak Vim mode"},{keyCode:52,func:ie,cmd:A.TOGGLE_LOCATION,desc:"Toggle speak row location"},{keyCode:53,func:oe,cmd:A.SPEAK_ROW_COL,desc:"Speak row and column"},{keyCode:54,func:ce,cmd:A.TOGGLE_DISPLACEMENT,desc:"Toggle speak displacement"},{keyCode:55,func:pe,cmd:A.FOCUS_TEXT,desc:"Focus text"}];var me=function(){o.editor=editor;editor.getSession().selection.on("changeCursor",J);editor.getSession().selection.on("changeSelection",Y);editor.getSession().on("change",j);editor.getSession().on("changeAnnotation",Z);editor.on("changeStatus",ve);editor.on("findSearchBox",le);editor.container.addEventListener("keydown",ue);h=editor.selection.getCursor()};var ge=function(e){me();de.forEach(function(e){b[e.keyCode]=e;T[e.cmd]=e});e.on("focus",me);if(O()){cvox.Api.setKeyEcho(false)}fe()};function Ae(){return typeof cvox!=="undefined"&&cvox&&cvox.Api}var ke=0;var he=15;function Se(e){if(Ae()){ge(e)}else{ke++;if(ke>=he){return}window.setTimeout(Se,500,e)}}var Ee=e("../editor").Editor;e("../config").defineOptions(Ee.prototype,"editor",{enableChromevoxEnhancements:{set:function(e){if(e){Se(this)}},value:true}})});(function(){ace.require(["ace/ext/chromevox"],function(){})})();