(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(e){"use strict";e.defineMode("velocity",function(){function e(e){var t={},r=e.split(" ");for(var n=0;n<r.length;++n)t[r[n]]=true;return t}var t=e("#end #else #break #stop #[[ #]] "+"#{end} #{else} #{break} #{stop}");var r=e("#if #elseif #foreach #set #include #parse #macro #define #evaluate "+"#{if} #{elseif} #{foreach} #{set} #{include} #{parse} #{macro} #{define} #{evaluate}");var n=e("$foreach.count $foreach.hasNext $foreach.first $foreach.last $foreach.topmost $foreach.parent.count $foreach.parent.hasNext $foreach.parent.first $foreach.parent.last $foreach.parent $velocityCount $!bodyContent $bodyContent");var a=/[+\-*&%=<>!?:\/|]/;function i(e,t,r){t.tokenize=r;return r(e,t)}function l(e,l){var u=l.beforeParams;l.beforeParams=false;var c=e.next();if(c=="'"&&l.inParams){l.lastTokenWasBuiltin=false;return i(e,l,s(c))}else if(c=='"'){l.lastTokenWasBuiltin=false;if(l.inString){l.inString=false;return"string"}else if(l.inParams)return i(e,l,s(c))}else if(/[\[\]{}\(\),;\.]/.test(c)){if(c=="("&&u)l.inParams=true;else if(c==")"){l.inParams=false;l.lastTokenWasBuiltin=true}return null}else if(/\d/.test(c)){l.lastTokenWasBuiltin=false;e.eatWhile(/[\w\.]/);return"number"}else if(c=="#"&&e.eat("*")){l.lastTokenWasBuiltin=false;return i(e,l,o)}else if(c=="#"&&e.match(/ *\[ *\[/)){l.lastTokenWasBuiltin=false;return i(e,l,f)}else if(c=="#"&&e.eat("#")){l.lastTokenWasBuiltin=false;e.skipToEnd();return"comment"}else if(c=="$"){e.eatWhile(/[\w\d\$_\.{}]/);if(n&&n.propertyIsEnumerable(e.current())){return"keyword"}else{l.lastTokenWasBuiltin=true;l.beforeParams=true;return"builtin"}}else if(a.test(c)){l.lastTokenWasBuiltin=false;e.eatWhile(a);return"operator"}else{e.eatWhile(/[\w\$_{}@]/);var k=e.current();if(t&&t.propertyIsEnumerable(k))return"keyword";if(r&&r.propertyIsEnumerable(k)||e.current().match(/^#@?[a-z0-9_]+ *$/i)&&e.peek()=="("&&!(r&&r.propertyIsEnumerable(k.toLowerCase()))){l.beforeParams=true;l.lastTokenWasBuiltin=false;return"keyword"}if(l.inString){l.lastTokenWasBuiltin=false;return"string"}if(e.pos>k.length&&e.string.charAt(e.pos-k.length-1)=="."&&l.lastTokenWasBuiltin)return"builtin";l.lastTokenWasBuiltin=false;return null}}function s(e){return function(t,r){var n=false,a,i=false;while((a=t.next())!=null){if(a==e&&!n){i=true;break}if(e=='"'&&t.peek()=="$"&&!n){r.inString=true;i=true;break}n=!n&&a=="\\"}if(i)r.tokenize=l;return"string"}}function o(e,t){var r=false,n;while(n=e.next()){if(n=="#"&&r){t.tokenize=l;break}r=n=="*"}return"comment"}function f(e,t){var r=0,n;while(n=e.next()){if(n=="#"&&r==2){t.tokenize=l;break}if(n=="]")r++;else if(n!=" ")r=0}return"meta"}return{startState:function(){return{tokenize:l,beforeParams:false,inParams:false,inString:false,lastTokenWasBuiltin:false}},token:function(e,t){if(e.eatSpace())return null;return t.tokenize(e,t)},blockCommentStart:"#*",blockCommentEnd:"*#",lineComment:"##",fold:"velocity"}});e.defineMIME("text/velocity","velocity")});