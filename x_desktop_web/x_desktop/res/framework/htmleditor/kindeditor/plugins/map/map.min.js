KindEditor.plugin("map",function(t){var e=this,a="map",o=e.lang(a+".");e.clickToolbar(a,function(){var n=['<div style="padding:10px 20px;">','<div class="ke-dialog-row">',o.address+' <input id="kindeditor_plugin_map_address" name="address" class="ke-input-text" value="" style="width:200px;" /> ','<span class="ke-button-common ke-button-outer">','<input type="button" name="searchBtn" class="ke-button-common ke-button" value="'+o.search+'" />',"</span>","</div>",'<div class="ke-map" style="width:558px;height:360px;"></div>',"</div>"].join("");var s=e.createDialog({name:a,width:600,title:e.lang(a),body:n,yesBtn:{name:e.lang("yes"),click:function(t){var a=d.geocoder,o=d.map,n=o.getCenter().lat()+","+o.getCenter().lng(),s=o.getZoom(),i=o.getMapTypeId(),r="http://maps.googleapis.com/maps/api/staticmap";r+="?center="+encodeURIComponent(n);r+="&zoom="+encodeURIComponent(s);r+="&size=558x360";r+="&maptype="+encodeURIComponent(i);r+="&markers="+encodeURIComponent(n);r+="&language="+e.langType;r+="&sensor=false";e.exec("insertimage",r).hideDialog().focus()}},beforeRemove:function(){l.remove();if(p){p.write("")}c.remove()}});var i=s.div,r=t('[name="address"]',i),l=t('[name="searchBtn"]',i),d,p;var m=["<!doctype html><html><head>",'<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />',"<style>","\thtml { height: 100% }","\tbody { height: 100%; margin: 0; padding: 0; background-color: #FFF }","\t#map_canvas { height: 100% }","</style>",'<script src="http://maps.googleapis.com/maps/api/js?sensor=false&language='+e.langType+'"></script>',"<script>","var map, geocoder;","function initialize() {","\tvar latlng = new google.maps.LatLng(31.230393, 121.473704);","\tvar options = {","\t\tzoom: 11,","\t\tcenter: latlng,","\t\tdisableDefaultUI: true,","\t\tpanControl: true,","\t\tzoomControl: true,","\t\tmapTypeControl: true,","\t\tscaleControl: true,","\t\tstreetViewControl: false,","\t\toverviewMapControl: true,","\t\tmapTypeId: google.maps.MapTypeId.ROADMAP","\t};",'\tmap = new google.maps.Map(document.getElementById("map_canvas"), options);',"\tgeocoder = new google.maps.Geocoder();","\tgeocoder.geocode({latLng: latlng}, function(results, status) {","\t\tif (status == google.maps.GeocoderStatus.OK) {","\t\t\tif (results[3]) {",'\t\t\t\tparent.document.getElementById("kindeditor_plugin_map_address").value = results[3].formatted_address;',"\t\t\t}","\t\t}","\t});","}","function search(address) {","\tif (!map) return;","\tgeocoder.geocode({address : address}, function(results, status) {","\t\tif (status == google.maps.GeocoderStatus.OK) {","\t\t\tmap.setZoom(11);","\t\t\tmap.setCenter(results[0].geometry.location);","\t\t\tvar marker = new google.maps.Marker({","\t\t\t\tmap: map,","\t\t\t\tposition: results[0].geometry.location","\t\t\t});","\t\t} else {",'\t\t\talert("Invalid address: " + address);',"\t\t}","\t});","}","</script>","</head>",'<body onload="initialize();">','<div id="map_canvas" style="width:100%; height:100%"></div>',"</body></html>"].join("\n");var c=t('<iframe class="ke-textarea" frameborder="0" src="'+e.pluginsPath+'map/map.html" style="width:558px;height:360px;"></iframe>');function g(){d=c[0].contentWindow;p=t.iframeDoc(c)}c.bind("load",function(){c.unbind("load");if(t.IE){g()}else{setTimeout(g,0)}});t(".ke-map",i).replaceWith(c);l.click(function(){d.search(r.val())})})});