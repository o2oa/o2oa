MWF.widget.SimpleEditor=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",title:"",hasHeadNode:true,hasTitleNode:true,editorDisabled:false,hasToolbar:true,toolbarDisable:false,hasSubmit:true,submitDisable:false,hasCustomArea:true,paragraphise:false,minHeight:200,maxHeight:717,limit:0,overFlow:"visible",width:"95%",action:"all"},initialize:function(t,e,i,s,o){this.protectRegex=/<(script|noscript|style)[\u0000-\uFFFF]*?<\/(script|noscript|style)>/g;this.setOptions(t);this.bindObject=o;this.protectedElements=[];this.path=MWF.defaultPath+"/widget/$SimpleEditor/";this.cssPath=MWF.defaultPath+"/widget/$SimpleEditor/"+this.options.style+"/css.wcss";this.editorPath=MWF.defaultPath+"/widget/$SimpleEditor/"+this.options.style+"/editor.html";this.toolbarButtonPath=MWF.defaultPath+"/widget/$SimpleEditor/"+this.options.style+"/toolbarItems.json";this._loadCss();this.iframe=s;this.container=document.id(e);this.data=i},load:function(t){if(!this.container)return;if(this.fireEvent("queryLoad",this)){if(this.iframe){this.win=this.iframe.contentWindow;this.doc=this.iframe.contentDocument?this.iframe.contentDocument:this.iframe.contentWindow.document;Object.append(this.win,new Window);Object.append(this.doc,new Document);if(Browser.Element){var e=this.win.Element.prototype;for(var i in Element){if(!i.test(/^[A-Z]|\$|prototype|mooEditable/)){e[i]=Element.prototype[i]}}}else{document.id(this.doc.body)}}else{this.win=window;this.doc=document}if(t){this.oldContent=t}else{this.oldContent=this.data}this.editorNode=this.createEditor();if(!this.editorNode)return;if(this.options.hasTitleNode)this.titleNode.set("text",this.options.title);this._setEditarea();if(this.options.hasToolbar)this._loadToolbar();if(this.options.hasSubmit)this.setSubmitNodeDisable(this.options.submitDisable);this.editorNode.inject(this.container);this.selection=new MWF.widget.SimpleEditor.Selection(this.win,this.doc);this.setContent(this.oldContent);if(this.iframe)this.setIframeHeight()}this.fireEvent("postLoad",this)},setIframeHeight:function(){try{var t=this.doc.body.scrollHeight;this.iframe.height=t}catch(t){}},createEditor:function(){var t=null;var e=new Request.HTML({url:this.editorPath,method:"GET",async:false,onSuccess:function(e,i,s,o){t=e[0]}});e.send();this.parentNode=t.getElement(".MWF_editor_parent");if(this.parentNode){this.parentNode.set("styles",this.css.MWF_editor_parent);this.parentNode.setStyle("width",this.options.width)}this.headNode=t.getElement(".MWF_editor_head");if(this.options.hasHeadNode){if(this.headNode)this.headNode.set("styles",this.css.MWF_editor_head)}else{this.headNode.dispose()}this.titleNode=t.getElement(".MWF_editor_title");if(this.titleNode){if(this.options.hasTitleNode){this.titleNode.set("styles",this.css.MWF_editor_title)}else{this.titleNode.dispose()}}else{this.options.hasTitleNode=false}this.wrapperNode=t.getElement(".MWF_editor_wrapper");if(this.wrapperNode)this.wrapperNode.set("styles",this.css.MWF_editor_wrapper);this.toolbarNode=t.getElement(".MWF_editor_toolbar");if(this.toolbarNode){if(this.options.hasToolbar){this.toolbarNode.set("styles",this.css.MWF_editor_toolbar)}else{this.toolbarNode.dispose()}}else{this.options.hasToolbar=false}this.editareaWrapperNode=t.getElement(".MWF_editor_editarea_wrapper");if(this.editareaWrapperNode)this.editareaWrapperNode.set("styles",this.css.MWF_editor_editarea_wrapper);this.editareaNode=t.getElement(".MWF_editor_editarea");if(this.editareaNode){this.editareaNode.set("styles",this.css.MWF_editor_editarea)}else{return null}this.editbottomNode=t.getElement(".MWF_editor_bottom");if(this.editbottomNode)this.editbottomNode.set("styles",this.css.MWF_editor_bottom);this.submitNode=t.getElement(".MWF_editor_submit");if(this.submitNode){if(this.options.hasSubmit){this.submitNode.set("styles",this.css.MWF_editor_submit)}else{this.submitNode.dispose()}}else{this.options.hasSubmit=false}this.editCustomInfoNode=t.getElement(".MWF_editor_remindarea");if(this.editCustomInfoNode){if(this.options.hasCustomArea){this.editCustomInfoNode.set("styles",this.css.MWF_editor_remindarea);if(this.options.limit&&this.options.limit!=0){this.editCustomInfoNode.set("text","0/"+this.options.limit)}}else{this.editCustomInfoNode.dispose()}}else{this.options.hasCustomArea=false}return t},setCustomInfo:function(t){if(this.options.hasCustomArea)this.editCustomInfoNode.set("text",t)},_setEditarea:function(){var t=Browser.name=="ie"&&!(typeof document.body.style.maxHeight!="undefined"&&document.compatMode=="CSS1Compat");if(t){this.editareaNode.set("styles",{overflowY:this.options.overFlow=="max"?"visible":this.options.overFlow,overflowX:"hidden",height:this.options.minHeight+"px"})}else{if(this.options.overFlow=="visible"){vMaxHeight=null;vHeight=this.options.minHeight+"px"}else if(this.options.overFlow=="auto"){vMaxHeight=null;vHeight=this.options.minHeight+"px"}else if(this.options.overFlow=="max"){vMaxHeight=this.options.maxHeight+"px";vHeight="auto"}this.editareaNode.set("styles",{height:vHeight,minHeight:this.options.minHeight+"px",maxHeight:vMaxHeight,overflowY:"auto",overflowX:"hidden"})}this.editareaNode.addEvents({mouseup:this._editorMouseUp.bind(this),mousedown:this._editorMouseDown.bind(this),mouseover:this._editorMouseOver.bind(this),mouseout:this._editorMouseOut.bind(this),mouseenter:this._editorMouseEnter.bind(this),mouseleave:this._editorMouseLeave.bind(this),contextmenu:this._editorContextMenu.bind(this),click:this._editorClick.bind(this),dblclick:this._editorDoubleClick.bind(this),keypress:this._editorKeyPress.bind(this),keyup:this._editorKeyUp.bind(this),keydown:this._editorKeyDown.bind(this),focus:this._editorFocus.bind(this),blur:this._editorBlur.bind(this),resize:this._editorResize.bind(this)});this.fireEvent("setEditarea",this)},setSubmitNodeDisable:function(t){if(t){if(this.css.MWF_editor_submit_disable){this.submitNode.set("styles",this.css.MWF_editor_submit_disable);this.submitNode.removeEvents()}}else{this.submitNode.set("styles",this.css.MWF_editor_submit);if(this.css.MWF_editor_submit_hover){this.submitNode.addEvents({mouseover:function(){this.submitNode.set("styles",this.css.MWF_editor_submit_hover)}.bind(this),mouseleave:function(){this.submitNode.set("styles",this.css.MWF_editor_submit)}.bind(this)})}this.submitNode.addEvent("click",function(){this.fireEvent("submitForm",this)}.bind(this))}},setDisable:function(t){this.options.editorDisabled=t;if(this.options.hasToolbar){this.toolbarDisable=t;this.toolbar.setDisable(t)}if(this.options.hasSubmit){this.options.submitDisable=t;this.setSubmitNodeDisable(t)}},execute:function(t,e,i){if(this.busy)return;this.busy=true;this.doc.execCommand(t,e,i);this.saveContent();this.busy=false;return false},setContent:function(t){var e=this.protectedElements;t=t.replace(this.protectRegex,function(t){e.push(t);return"<!-- editor:protect:"+(e.length-1)+" -->"});this.editareaNode.set("html",t);this.checkLimit("");return this},getContent:function(){var t=this.protectedElements;var e=this.editareaNode.get("html").replace(/<!-- editor:protect:([0-9]+) -->/g,function(e,i){return t[i.toInt()]});if(this.options.paragraphise)e=e.replace(/(h[1-6]|p|div|address|pre|li|ol|ul|blockquote|center|dl|dt|dd)><br ?\/?>/gi,"$1>");return e},clear:function(){this.setContent("");if(this.options.hasCustomArea){if(this.options.limit&&this.options.limit!=0){this.editCustomInfoNode.set("text","0/"+this.options.limit)}}},checkLimit:function(){if(this.options.limit==0)return;var t=this.editareaNode.get("html");this.contentLength=t.length;if(this.editCustomInfoNode){if(t=="<br>"){this.editCustomInfoNode.set("text","0/"+this.options.limit)}else{this.editCustomInfoNode.set("text",this.contentLength+"/"+this.options.limit)}}if(this.contentLength>this.options.limit){if(!this.beyondLimit){this.editareaNodeBGColor=this.editareaNode.getStyle("backgroundColor");this.editareaNode.setStyle("backgroundColor","rgb(255, 216, 216)");this.setSubmitNodeDisable(true);this.beyondLimit=true}}else{if(this.beyondLimit){this.editareaNode.setStyle("backgroundColor",this.editareaNodeBGColor);this.setSubmitNodeDisable(false);this.beyondLimit=false}}},_loadToolbar:function(){this.toolbar=new MWF.widget.SimpleEditor.Toolbar({style:this.options.style,disable:this.options.toolbarDisable,action:this.options.action,onQueryToolbarLoad:function(){return true},onPostToolbarLoad:function(){}},null,this.css,this.toolbarNode,this);this.toolbar.toolbarButtonPath=this.toolbarButtonPath;this.toolbar.load()},_editorResize:function(t){if(this.options.editorDisabled){t.stopPropagation();return}if(this.iframe&&(this.options.overFlow=="visible"||this.options.overFlow=="max"))this.setIframeHeight();this.fireEvent("_editorResize",[t,this])},_editorFocus:function(t){this.oldContent="";this.fireEvent("editorFocus",[t,this])},_editorBlur:function(t){this.oldContent=this.getContent();this.checkLimit();this.fireEvent("editorBlur",[t,this])},_editorMouseUp:function(t){if(this.options.editorDisabled){t.stopPropagation();return}this.selectionRange=this.selection.getRange();this.fireEvent("editorMouseUp",[t,this])},_editorMouseDown:function(t){if(this.options.editorDisabled){t.stopPropagation();return}this.fireEvent("editorMouseDown",[t,this])},_editorMouseOver:function(t){if(this.options.editorDisabled){t.stopPropagation();return}this.fireEvent("editorMouseOver",[t,this])},_editorMouseOut:function(t){if(this.options.editorDisabled){t.stopPropagation();return}this.fireEvent("editorMouseOut",[t,this])},_editorMouseEnter:function(t){if(this.options.editorDisabled){t.stopPropagation();return}this.fireEvent("editorMouseEnter",[t,this])},_editorMouseLeave:function(t){if(this.options.editorDisabled){t.stopPropagation();return}this.fireEvent("editorMouseLeave",[t,this])},_editorContextMenu:function(t){if(this.options.editorDisabled){t.stopPropagation();return}this.fireEvent("editorContextMenu",[t,this])},_editorClick:function(t){if(Browser.name=="safari"||Browser.name=="chrome"){var e=t.target;if(Element.get(e,"tag")=="img"){this.selection.selectNode(e)}}this.selectionRange=this.selection.getRange();this.fireEvent("editorClick",[t,this])},_editorDoubleClick:function(t){this.fireEvent("editorDoubleClick",[t,this])},_editorKeyPress:function(t){if(this.options.editorDisabled){t.stopPropagation();return}this.fireEvent("editorKeyPress",[t,this])},_editorKeyDown:function(t){if(this.options.editorDisabled){t.stopPropagation();return}if(t.key=="enter"){if(this.options.paragraphise){if(t.shift&&(Browser.name=="safari"||Browser.name=="chrome"||Browser.name=="firefox")){var e=this.selection;var i=e.getRange();var s=this.doc.createElement("br");i.insertNode(s);i.setStartAfter(s);i.setEndAfter(s);e.setRange(i);if(e.getSelection().focusNode==s.previousSibling){var o=this.doc.createTextNode("Â ");var n=s.parentNode;var h=s.nextSibling;h?n.insertBefore(o,h):n.appendChild(o);e.selectNode(o);e.collapse(1)}this.win.scrollTo(0,Element.getOffsets(e.getRange().startContainer).y);t.preventDefault()}else if(Browser.name=="safari"||Browser.name=="chrome"||Browser.name=="firefox"){var r=this.selection.getNode();var a=Element.getParents(r).include(r).some(function(t){return t.nodeName.test(blockEls)});if(!a)this.execute("insertparagraph")}}else{if(Browser.name=="ie"){var i=this.selection.getRange();var r=this.selection.getNode();if(i){if(!r||r.get("tag")!="li"){this.selection.insertContent("<br>");i.select();this.selection.collapse(false)}}t.preventDefault()}}}this.fireEvent("editorKeyDown",[t,this])},_editorKeyUp:function(t){if(this.options.editorDisabled){t.stopPropagation();return}this.selectionRange=this.selection.getRange();if(this.iframe&&(this.options.overFlow=="visible"||this.options.overFlow=="max"))this.setIframeHeight();this.checkLimit();this.fireEvent("editorKeyUp",[t,this])}});MWF.widget.SimpleEditor.Toolbar=new Class({Implements:[Options,Events],options:{style:"default",disable:false,action:"all"},initialize:function(t,e,i,s,o){this.setOptions(t);this.container=e;this.css=i;this.editor=o;if(s){this.node=s;this.hasNode=true}else{this.hasNode=false}this.toolbarButtonPath=MWF.defaultPath+"/widget/SimpleEditor/"+this.options.style+"/toolbarItems.json";this.actions=this.options.action.split(" ");this.items=[];this.children=[];this.childrenButton=[];this.childrenMenu=[]},load:function(){if(this.fireEvent("queryToolbarLoad")){if(!this.node){this.node=new Element("div",{styles:this.css.MWF_editor_toolbar,class:"MWF_editor_toolbar"})}var t=new Request.JSON({url:this.toolbarButtonPath,secure:false,async:false,method:"get",noCache:true,onSuccess:function(t,e){nodes=t.item;if(nodes){if(this.actions.indexOf("all")!=-1){nodes.each(function(t,e){switch(t.type){case"button":this._loadToolBarButton(t);break;case"menu":break;case"separator":this._loadToolBarSeparator();break;default:break}}.bind(this))}else{var i={};nodes.each(function(t,e){if(t.type=="button"||t.type=="menu")i[t.actionName]=t});this.actions.each(function(t,e){if(t=="|"){this._loadToolBarSeparator()}else if(i[t]){node=i[t];if(node.type=="button"){this._loadToolBarButton(node)}else if(node.type=="menu"){}}}.bind(this))}}if(!this.hasNode)this.node.inject(this.container)}.bind(this),onError:function(t,e){alert(t)}});t.send();this.fireEvent("postToolbarLoad")}},_loadToolBarSeparator:function(){var t=new Element("label");t.set("styles",this.css.MWF_editor_toolbar_separator);t.inject(this.node)},_loadToolBarButton:function(t){if(t){if(this.options.disable)t.disable=true;var e=new MWF.widget.SimpleEditor.ToolbarButton(t,this.node,this.css,this);e.options.style=this.options.style;e.load();this.fireEvent("buttonLoad",[e]);if(e.buttonID){this.items[e.buttonID]=e}this.children.push(e);this.childrenButton.push(e)}},_loadToolBarMenu:function(t){var e=this;if(t){}},setDisable:function(t){this.childrenButton.each(function(e,i){e.setDisable(t)}.bind(this))}});MWF.widget.SimpleEditor.ToolbarButton=new Class({Implements:[Options,Events],options:{style:"default",id:"",text:"",title:"",pic:"",picDisable:"",actionName:"",dialog:"",disable:false},initialize:function(t,e,i,s){this.setOptions(t);this.toolbar=s;if(this.toolbar.editor)this.editor=this.toolbar.editor;this.toolbarNode=e;this.css=i;if(this.options.id!="")this.buttonID=this.options.id;this.modifiyStyle=false;this.isActive=false;this.dialogs={}},load:function(){this.fireEvent("queryButtonLoad");this.node=new Element("span");this.node.set("styles",this.css.MWF_editor_toolbar_button_span);this.node.title=this.options.title;if(this.options.pic&&this.options.pic!="")this.picNode=this._createImageNode(this.options.pic);if(this.options.text&&this.options.text!="")this.textNode=this._createTextNode(this.options.text);if(this.options.disable)this.setDisable(this.options.disable);this.node.inject(this.toolbarNode);var t=this.options.actionName;MWF.require("MWF.widget.$SimpleEditor.Actions."+t,function(){this.action=new MWF.widget.SimpleEditor.Actions[t]({style:this.options.style},this.editor,this.toolbar,this);if(!this.action)return;if(this.action.options){}if(this.action.showDialog){}if(this.action.events){Object.each(this.action.events,function(t,e){this.addEvent(e,t)},this)}}.bind(this));this._addButtonEvent();this.fireEvent("postButtonLoad",this)},setDisable:function(t){if(t){this.node.set("styles",this.css.MWF_editor_toolbar_button_disable);if(this.picNode){this.picNode.set("styles",this.css.MWF_editor_toolbar_button_imagediv_disable);var e=this.picNode.getElement("img");e.set("src",this.options.picDisable)}if(this.textNode)this.textNode.set("styles",this.css.MWF_editor_toolbar_button_textdiv_disable);this.options.disable=true}else{this.node.set("styles",this.css.MWF_editor_toolbar_button);if(this.picNode){this.picNode.set("styles",this.css.MWF_editor_toolbar_button_imagediv);var e=this.picNode.getElement("img");e.set("src",this.options.pic)}if(this.textNode)this.textNode.set("styles",this.css.MWF_editor_toolbar_button_textdiv);this.options.disable=false}},_createImageNode:function(t){if(t){var e=new Element("span",{styles:this.css.MWF_editor_toolbar_button_imagediv}).inject(this.node);var i=new Element("img",{styles:this.css.MWF_editor_toolbar_button_image,src:t}).inject(e);return e}else{return null}},_createTextNode:function(t){if(t){var e=new Element("span",{styles:this.css.MWF_editor_toolbar_button_textdiv,text:t}).inject(this.node);return e}else{return null}},_addButtonEvent:function(){this.node.addEvent("mouseover",this._buttonMouseOver.bind(this));this.node.addEvent("mouseout",this._buttonMouseOut.bind(this));this.node.addEvent("mousedown",this._buttonMouseDown.bind(this));this.node.addEvent("mouseup",this._buttonMouseUp.bind(this));this.node.addEvent("click",this._buttonClick.bind(this))},_buttonMouseOver:function(){if(this.modifiyStyle&&!this.options.disable)if(!this.options.disable){this.node.set("styles",this.css.MWF_editor_toolbar_button_over)}},_buttonMouseOut:function(){if(this.modifiyStyle&&!this.options.disable)if(!this.options.disable){this.node.set("styles",this.css.MWF_editor_toolbar_button_out)}},_buttonMouseDown:function(){if(this.modifiyStyle&&!this.options.disable)if(!this.options.disable){this.node.set("styles",this.css.MWF_editor_toolbar_button_down)}},_buttonMouseUp:function(){if(this.modifiyStyle&&!this.options.disable)if(!this.options.disable){this.node.set("styles",this.css.MWF_editor_toolbar_button_up)}},_buttonClick:function(){if(!this.options.disable){if(this.options.actionName&&this.action&&this.action.showDialog){if(!this.isActive){this.toolbar.childrenButton.each(function(t,e){if(t.isActive&&t.action&&t.action.closeDialog){t.action.closeDialog.call(t.action)}});this.action.showDialog.call(this.action);this.isActive=true}}}}});MWF.widget.SimpleEditor.Selection=new Class({initialize:function(t,e){this.win=t;this.doc=e},getSelection:function(){return this.doc.selection?this.doc.selection:this.win.getSelection()},getRange:function(){var t=this.getSelection();if(!t)return null;try{return t.rangeCount>0?t.getRangeAt(0):t.createRange?t.createRange():null}catch(t){return this.doc.body.createTextRange()}},setRange:function(t){if(t.select){Function.attempt(function(){t.select()})}else{var e=this.getSelection();if(e.addRange){e.removeAllRanges();e.addRange(t)}}},selectNode:function(t,e){var i=this.getRange();var s=this.getSelection();if(i.moveToElementText){Function.attempt(function(){i.moveToElementText(t);i.select()})}else if(s.addRange){e?i.selectNodeContents(t):i.selectNode(t);s.removeAllRanges();s.addRange(i)}else{s.setBaseAndExtent(t,0,t,1)}return t},isCollapsed:function(){var t=this.getRange();if(t.item)return false;return t.boundingWidth==0||this.getSelection().isCollapsed},collapse:function(t){var e=this.getRange();var i=this.getSelection();if(e.select){e.collapse(t);e.select()}else{t?i.collapseToStart():i.collapseToEnd()}},getContent:function(){var t=this.getRange();var e=new Element("body");if(this.isCollapsed())return"";if(t.cloneContents){e.appendChild(t.cloneContents())}else if(t.item!=undefined||t.htmlText!=undefined){e.set("html",t.item?t.item(0).outerHTML:t.htmlText)}else{e.set("html",t.toString())}var i=e.get("html");return i},getText:function(){var t=this.getRange();var e=this.getSelection();return this.isCollapsed()?"":t.text||(e.toString?e.toString():"")},getNode:function(){var t=this.getRange();if(Browser.name!="ie"||Browser.version>=9){var e=null;if(t){e=t.commonAncestorContainer;if(!t.collapsed)if(t.startContainer==t.endContainer)if(t.startOffset-t.endOffset<2)if(t.startContainer.hasChildNodes())e=t.startContainer.childNodes[t.startOffset];while(typeOf(e)!="element"&&e)e=e.parentNode}return document.id(e)}return document.id(t.item?t.item(0):t.parentElement())},insertContent:function(t){if(Browser.name=="ie"){var e=this.getRange();if(e.pasteHTML){e.pasteHTML(t);e.collapse(false);e.select()}else if(e.insertNode){e.deleteContents();if(e.createContextualFragment){e.insertNode(e.createContextualFragment(t))}else{var i=this.doc;var s=i.createDocumentFragment();var o=i.createElement("div");s.appendChild(o);o.outerHTML=t;e.insertNode(s)}e.collapse(false)}}else{this.win.document.execCommand("insertHTML",false,t)}}});MWF.widget.SimpleEditor.Dialog=new Class({Implements:[Options,Events],options:{style:"default",fx:false,title:"dialog",width:"300",height:"150",top:"0",left:"0",fromTop:"0",fromLeft:"0",mark:true,html:"",text:"",url:"",content:null,isMax:false,isClose:true,isResize:true,isMove:true,buttons:null},initialize:function(t,e){this.setOptions(e);this.path=MWF.defaultPath+"/widget/$SimpleEditor/"+this.options.style+"/Dialog/";this.cssPath=MWF.defaultPath+"/widget/$SimpleEditor/"+this.options.style+"/Dialog/css.wcss";this._loadCss();if(t){this.container=$(t)}else{this.container=$(document.body)}this.css.to.height=this.options.height;this.css.to.width=this.options.width;this.css.to.top=this.options.top;this.css.to.left=this.options.left;this.css.from.top=this.options.fromTop;this.css.from.left=this.options.fromLeft;this.contentUrl=MWF.defaultPath+"/widget/$SimpleEditor/"+this.options.style+"/Dialog/dialog.html";var i=new Request.HTML({url:this.contentUrl,method:"GET",async:false,onSuccess:function(t,e,i,s){this.node=t[0];this.getDialogNode();this.fireEvent("postLoad",this)}.bind(this),onFailure:function(t){alert(t)}});i.send()},_loadCss:function(){var t=new Request.JSON({url:this.cssPath,secure:false,async:false,method:"get",noCache:true,onSuccess:function(t,e){this.css=t}.bind(this),onError:function(t,e){alert(t)}});t.send()},reStyle:function(t){if(t)this.setOptions(t);this.css.to.height=this.options.height;this.css.to.width=this.options.width;this.css.to.top=this.options.top;this.css.to.left=this.options.left;this.css.to.top=this.options.top;this.css.from.top=this.options.fromTop;this.css.from.left=this.options.fromLeft;this.node.set("styles",this.css.from)},getDialogNode:function(){this.node.set("styles",this.css.from);this.title=this.node.getElement(".MWF_dialod_title");this.titleCenter=this.node.getElement(".MWF_dialod_title_center");this.titleText=this.node.getElement(".MWF_dialod_title_text");this.titleAction=this.node.getElement(".MWF_dialod_title_action");this.content=this.node.getElement(".MWF_dialod_content");this.bottom=this.node.getElement(".MWF_dialod_bottom");this.resizeNode=this.node.getElement(".MWF_dialod_bottom_resize");this.button=this.node.getElement(".MWF_dialod_button");if(this.title){this.title.addEvent("mousedown",function(){this.containerDrag=new Drag.Move(this.node)}.bind(this));this.title.addEvent("mouseup",function(){this.node.removeEvents("mousedown");this.title.addEvent("mousedown",function(){this.containerDrag=new Drag.Move(this.node)}.bind(this))}.bind(this))}if(this.titleText)this.getTitle();if(this.content)this.getContent();if(this.titleAction)this.getAction();if(this.resizeNode)this.setResizeNode();if(this.button)this.getButton();if(this.content)this.setContentSize();this.fireEvent("queryInjectNode");this.node.inject(this.container)},getButton:function(){for(i in this.options.buttons){var t=new Element("input",{type:"button",value:i,styles:this.css.button,events:{click:this.options.buttons[i].bind(this)}}).inject(this.button)}},setContentSize:function(){var t=this.options.height;if(this.title){var e=this.title.getSize().y;t=t-e}if(this.bottom){var i=this.bottom.getSize().y;t=t-i}if(this.button){var s=this.button.getSize().y;t=t-s}this.content.setStyle("height",t)},getTitle:function(){this.titleText.set("text",this.options.title)},getContent:function(){if(this.options.content){this.options.content().inject(this.content)}else if(this.options.url){this.content.set("load",{method:"get",async:false});$(this.content).load(this.options.url)}else if(this.options.html){this.content.set("html",this.options.html)}else if(this.options.text){this.content.set("text",this.options.text)}},show:function(){if(this.options.mark)this._markShow();if(!this.morph&&this.options.fx){this.morph=new Fx.Morph(this.node,{duration:200})}if(this.fireEvent("queryShow")){this.node.setStyle("display","block");if(this.options.fx){this.morph.start(this.css.to).chain(function(){this.fireEvent("postShow")}.bind(this))}else{this.node.setStyles(this.css.to);this.fireEvent("postShow")}}},hide:function(){if(!this.morph&&this.options.fx){this.morph=new Fx.Morph(this.node,{duration:200})}if(this.fireEvent("queryHide")){if(this.options.fx){this.morph.start(this.css.from).chain(function(){this._markHide();this.node.setStyle("display","none");this.fireEvent("postHide")}.bind(this))}else{this._markHide();this.node.setStyle("display","none");this.fireEvent("postHide")}}},close:function(){if(!this.morph&&this.options.fx){this.morph=new Fx.Morph(this.node,{duration:200})}if(this.fireEvent("queryClose")){if(this.options.fx){this.morph.start(this.css.from).chain(function(){this._markClose();this.node.destroy();this.node=null;this.fireEvent("postClose")}.bind(this))}else{this._markClose();this.node.destroy();this.fireEvent("postClose")}}},_markShow:function(){if(this.options.mark){if(!this.markNode){var t=MWF.getMarkSize();this.markNode=new Element("div",{styles:this.css.mark}).inject($(document.body));this.markNode.set("styles",{height:t.y,width:t.x})}this.markNode.setStyle("display","block")}},_markHide:function(){if(this.markNode){this.markNode.setStyle("display","none")}},_markClose:function(){if(this.markNode){this.markNode.destroy()}}});MWF.widget.SimpleEditor.Actions=MWF.widget.SimpleEditor.Actions||{};MWF.widget.SimpleEditor.Actions.setting=MWF.widget.SimpleEditor.Actions.setting||{};